package view;
import javax.swing.*;
import javax.swing.border.EmptyBorder;
import javax.swing.border.LineBorder;
import java.awt.*;
import java.awt.geom.RoundRectangle2D;

public class OrderScreenUI extends JFrame {

    // Màu sắc chủ đạo lấy từ ảnh
    private static final Color BG_COLOR = new Color(245, 246, 250); // Xám nhạt nền
    private static final Color TEXT_DARK = new Color(20, 20, 60);   // Xanh đen đậm
    private static final Color TEXT_RED = new Color(230, 50, 50);   // Đỏ cảnh báo
    private static final Color BTN_COLOR = new Color(60, 60, 70);   // Màu nút thanh toán
    private static final Font FONT_BOLD = new Font("Segoe UI", Font.BOLD, 14);
    private static final Font FONT_PLAIN = new Font("Segoe UI", Font.PLAIN, 14);
    private static final Font FONT_HEADER = new Font("Segoe UI", Font.BOLD, 18);

    public OrderScreenUI() {
        setTitle("Thông tin đơn hàng");
        setSize(420, 750); // Kích thước tỷ lệ điện thoại
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);
        getContentPane().setBackground(BG_COLOR);
        setLayout(new BorderLayout());

        // 1. HEADER (Thanh tiêu đề)
        add(createHeader(), BorderLayout.NORTH);

        // 2. CONTENT (Nội dung chính có cuộn)
        JPanel contentPanel = new JPanel();
        contentPanel.setLayout(new BoxLayout(contentPanel, BoxLayout.Y_AXIS));
        contentPanel.setBackground(BG_COLOR);
        contentPanel.setBorder(new EmptyBorder(10, 15, 10, 15));

        // -- Thêm các phần tử vào content --
        contentPanel.add(Box.createVerticalStrut(10));
        contentPanel.add(createPaymentMethodSection());
        
        contentPanel.add(Box.createVerticalStrut(20));
        contentPanel.add(createSectionTitle("Thông tin thanh toán"));
        contentPanel.add(Box.createVerticalStrut(5));
        contentPanel.add(createPaymentDetailsPanel());

        contentPanel.add(Box.createVerticalStrut(20));
        contentPanel.add(createSectionTitle("Thông tin Vé 1 ngày"));
        contentPanel.add(Box.createVerticalStrut(5));
        contentPanel.add(createTicketInfoPanel());

        // Wrap content trong ScrollPane
        JScrollPane scrollPane = new JScrollPane(contentPanel);
        scrollPane.setBorder(null);
        scrollPane.getVerticalScrollBar().setUnitIncrement(16);
        add(scrollPane, BorderLayout.CENTER);

        // 3. FOOTER (Nút thanh toán)
        add(createFooter(), BorderLayout.SOUTH);
    }

    // --- CÁC HÀM TẠO COMPONENT ---

    private JPanel createHeader() {
        JPanel header = new JPanel(new BorderLayout());
        header.setBackground(Color.WHITE);
        header.setBorder(new EmptyBorder(15, 15, 15, 15));

        JLabel lblBack = new JLabel("\u2190"); // Mũi tên trái
        lblBack.setFont(new Font("Segoe UI", Font.BOLD, 20));
        
        JLabel lblTitle = new JLabel("Thông tin đơn hàng", SwingConstants.CENTER);
        lblTitle.setFont(FONT_HEADER);
        lblTitle.setForeground(new Color(20, 0, 80));

        // Dummy label để cân giữa tiêu đề
        JLabel lblDummy = new JLabel("   "); 

        header.add(lblBack, BorderLayout.WEST);
        header.add(lblTitle, BorderLayout.CENTER);
        header.add(lblDummy, BorderLayout.EAST);
        
        return header;
    }

    private JPanel createPaymentMethodSection() {
        JPanel panel = new RoundedPanel(15, Color.WHITE);
        panel.setLayout(new BorderLayout());
        panel.setBorder(new EmptyBorder(15, 15, 15, 15));
        panel.setMaximumSize(new Dimension(Integer.MAX_VALUE, 60));

        JLabel lblIcon = new JLabel("\uD83D\uDCB3  Phương thức thanh toán"); // Icon thẻ
        lblIcon.setFont(FONT_PLAIN);
        lblIcon.setForeground(TEXT_DARK);

        JLabel lblArrow = new JLabel(">");
        lblArrow.setForeground(Color.GRAY);

        panel.add(lblIcon, BorderLayout.CENTER);
        panel.add(lblArrow, BorderLayout.EAST);
        
        return panel;
    }

    private JLabel createSectionTitle(String title) {
        JLabel lbl = new JLabel(title);
        lbl.setFont(FONT_HEADER);
        lbl.setForeground(new Color(10, 10, 50));
        lbl.setAlignmentX(Component.LEFT_ALIGNMENT);
        return lbl;
    }

    private JPanel createPaymentDetailsPanel() {
        JPanel panel = new RoundedPanel(15, new Color(248, 249, 253)); // Nền hơi xanh nhạt
        panel.setLayout(new GridBagLayout());
        panel.setBorder(new EmptyBorder(15, 15, 15, 15));
        GridBagConstraints gbc = new GridBagConstraints();
        gbc.fill = GridBagConstraints.HORIZONTAL;
        gbc.insets = new Insets(5, 0, 5, 0);

        // Dữ liệu mẫu
        addDetailRow(panel, gbc, 0, "Sản phẩm:", "Vé 1 ngày", false);
        addDetailRow(panel, gbc, 1, "Đơn giá:", "40.000đ", false);
        addDetailRow(panel, gbc, 2, "Số lượng:", "1", false);
        addDetailRow(panel, gbc, 3, "Thành tiền:", "40.000đ", true);

        // Đường kẻ ngang
        JSeparator sep = new JSeparator();
        sep.setForeground(Color.LIGHT_GRAY);
        gbc.gridy = 4; gbc.gridwidth = 2; gbc.insets = new Insets(10, 0, 10, 0);
        panel.add(sep, gbc);

        // Tổng tiền
        gbc.gridwidth = 1;
        addDetailRow(panel, gbc, 5, "Tổng giá tiền:", "40.000đ", false);
        addDetailRow(panel, gbc, 6, "Thành tiền:", "40.000đ", true); // Đậm

        return panel;
    }

    private JPanel createTicketInfoPanel() {
        JPanel panel = new RoundedPanel(15, new Color(248, 249, 253));
        panel.setLayout(new GridBagLayout());
        panel.setBorder(new EmptyBorder(15, 15, 15, 15));
        GridBagConstraints gbc = new GridBagConstraints();
        gbc.fill = GridBagConstraints.HORIZONTAL;
        gbc.insets = new Insets(8, 0, 8, 0);

        // Loại vé
        addDetailRow(panel, gbc, 0, "Loại vé:", "Vé 1 ngày", false);
        
        // HSD
        addDetailRow(panel, gbc, 1, "HSD:", "24h kể từ thời điểm kích hoạt", false);

        // Lưu ý (Màu đỏ và text dài)
        gbc.gridy = 2; gbc.gridx = 0; gbc.weightx = 0.3; gbc.anchor = GridBagConstraints.NORTHWEST;
        JLabel lblTitle = new JLabel("Lưu ý:");
        lblTitle.setFont(FONT_BOLD);
        lblTitle.setForeground(TEXT_RED);
        panel.add(lblTitle, gbc);

        gbc.gridx = 1; gbc.weightx = 0.7;
        JTextArea txtNote = new JTextArea("Tự động kích hoạt sau 30 ngày kể từ ngày mua vé");
        txtNote.setFont(FONT_PLAIN);
        txtNote.setForeground(TEXT_RED);
        txtNote.setLineWrap(true);
        txtNote.setWrapStyleWord(true);
        txtNote.setOpaque(false);
        txtNote.setEditable(false);
        panel.add(txtNote, gbc);

        return panel;
    }

    // Hàm hỗ trợ thêm dòng dữ liệu (Label trái - Label phải)
    private void addDetailRow(JPanel p, GridBagConstraints gbc, int row, String key, String value, boolean isBold) {
        gbc.gridy = row;
        
        // Cột trái (Key)
        gbc.gridx = 0; 
        gbc.weightx = 0.4;
        gbc.anchor = GridBagConstraints.WEST;
        JLabel lblKey = new JLabel(key);
        lblKey.setFont(FONT_BOLD); // Key luôn hơi đậm
        lblKey.setForeground(TEXT_DARK);
        p.add(lblKey, gbc);

        // Cột phải (Value)
        gbc.gridx = 1; 
        gbc.weightx = 0.6;
        gbc.anchor = GridBagConstraints.EAST;
        JLabel lblValue = new JLabel(value);
        lblValue.setFont(isBold ? FONT_BOLD : FONT_PLAIN);
        lblValue.setForeground(TEXT_DARK);
        p.add(lblValue, gbc);
    }

    private JPanel createFooter() {
        JPanel footer = new JPanel();
        footer.setLayout(new BoxLayout(footer, BoxLayout.Y_AXIS));
        footer.setBackground(Color.WHITE);
        footer.setBorder(new EmptyBorder(10, 15, 20, 15));

        // Dòng text điều khoản (HTML để chỉnh màu link)
        JLabel lblTerm = new JLabel("<html>Bằng việc bấm thanh toán, bạn đồng ý với <font color='#0099ff'><u>điều khoản</u></font> của Metro</html>");
        lblTerm.setFont(new Font("Segoe UI", Font.PLAIN, 12));
        lblTerm.setForeground(Color.GRAY);
        lblTerm.setAlignmentX(Component.CENTER_ALIGNMENT);

        // Nút Thanh toán
        JButton btnPay = new JButton("Thanh toán: 40.000đ");
        btnPay.setFont(new Font("Segoe UI", Font.BOLD, 16));
        btnPay.setForeground(Color.WHITE);
        btnPay.setBackground(BTN_COLOR);
        btnPay.setFocusPainted(false);
        btnPay.setBorder(BorderFactory.createEmptyBorder(12, 0, 12, 0));
        btnPay.setMaximumSize(new Dimension(Integer.MAX_VALUE, 50));
        btnPay.setAlignmentX(Component.CENTER_ALIGNMENT);
        
        // Làm cho nút bo tròn bằng cách override paintComponent (hoặc dùng RoundedPanel bọc ngoài)
        // Ở đây để đơn giản ta dùng setUI hoặc style cơ bản, 
        // để đẹp hơn ta custom ButtonUI (dưới đây là cách đơn giản hoá)
        btnPay.setOpaque(true); 
        btnPay.setBorderPainted(false);

        // Custom nút bo tròn thủ công
        JPanel btnContainer = new RoundedPanel(25, BTN_COLOR);
        btnContainer.setLayout(new BorderLayout());
        JLabel lblBtnText = new JLabel("Thanh toán: 40.000đ", SwingConstants.CENTER);
        lblBtnText.setForeground(Color.WHITE);
        lblBtnText.setFont(new Font("Segoe UI", Font.BOLD, 16));
        btnContainer.add(lblBtnText, BorderLayout.CENTER);
        btnContainer.setMaximumSize(new Dimension(Integer.MAX_VALUE, 50));
        btnContainer.setCursor(new Cursor(Cursor.HAND_CURSOR));

        footer.add(lblTerm);
        footer.add(Box.createVerticalStrut(10));
        footer.add(btnContainer); // Sử dụng panel giả làm nút để đẹp hơn

        return footer;
    }

    public static void main(String[] args) {
        // Chạy trên Event Dispatch Thread
        SwingUtilities.invokeLater(() -> {
            new OrderScreenUI().setVisible(true);
        });
    }

    // --- CLASS HỖ TRỢ VẼ PANEL BO TRÒN ---
    static class RoundedPanel extends JPanel {
        private int cornerRadius;
        private Color backgroundColor;

        public RoundedPanel(int radius, Color bgColor) {
            super();
            this.cornerRadius = radius;
            this.backgroundColor = bgColor;
            setOpaque(false); // Để vẽ trong suốt phần góc bo
        }

        @Override
        protected void paintComponent(Graphics g) {
            super.paintComponent(g);
            Graphics2D graphics = (Graphics2D) g;
            graphics.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);

            graphics.setColor(backgroundColor);
            graphics.fillRoundRect(0, 0, getWidth(), getHeight(), cornerRadius, cornerRadius);
        }
    }
}